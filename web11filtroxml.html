<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
<h1>Filtros XML </h1>
<label >Introduzca ID: </label>
<input type="text"  id="cajaid"/>
<button id="botonAtributo">Filtrar XML departamentos por atributo ID</button>
<h1 style="color:red" id="mensaje"></h1>
<hr/>

<label >Introduzca localidad: </label>
<input type="text"  id="cajaLocalidad"/>
<button id="botonLoc">Filtrar XML departamentos por localidad </button>



<div id="mensaje"></div>
<ul id="listadepartamentos"></ul>
<table id="tabladepartamentos">
    <thead>
        <tr>
            <th>NUMERO</th>
            <th>NOMBRE</th>
            <th>LOCALIDAD</th>
        </tr>
    </thead>
    <tbody></tbody> 
</table>
<hr/>


    <script src="js/jquery-3.7.1.js"></script>
    <script>
        $(document).ready(function(){
            $("#botonAtributo").click(function(){
                console.log("Antes del servicio");
                //obtención de los datos
                $.get("documents/departamentos.xml",function(data){
                    console.log("Leyendo");
                    //EL FILTRO SERÁ EL SIGUIENTE[DEPT[DEPT_NO=10]]
                    
                    var id= $("#cajaid").val();
                    var filtro = "DEPT[DEPT_NO="+ id + "]"
                    //solamente tenemos un id por departamento osea q no sería necesario el first
                    var nododept =$(data).find(filtro).first();
                    var nombre =$(nododept).find("DNOMBRE").text();
                    var loc =$(nododept).find("LOC").text();
                    $("#mensaje").text("Departamento: "+ nombre + " Localidad: " + loc);
                })

            })

            $("#botonLoc").click(function(){
                console.log("Antes del servicio");
                //obtención de los datos
                $.get("documents/departamentos.xml",function(data){
                    console.log("Leyendo");

                    var loc= $("#cajaLocalidad").val();
                    
                    if(loc==""){
                        alert("No existe esa localidad");
                        return
                    }
                    //función con contains pero sin la funcionalidad del filtro
                     /*var filtro = "LOC:contains("  + loc + ")"
                    //ESTA VEZ SON VARIOS ELEMENTOS QUE NOS PODRÍAN DEVOLVER POR LO TANTO USARÍAMOS EACH
                    var html="";

                    $(data).find(filtro).each(function(){

                       //RECUPERAMOS EL DEPARTAMENTO COMPLETO
                        var nombreDept=$(this).parent().find("DNOMBRE").text();
                        var numDept=$(this).parent().attr("DEPT_NO")
                        var objecto = $(this).text();                       
                        

                        //html += "<li>"+ objecto + "</li>"
                        html += "<tr>";
                        html += "<td>"+ numDept + "</td>"
                        html += "<td>"+ nombreDept + "</td>"
                        html += "<td>"+ objecto + "</td>"
                        html += "</tr>"

                    })*/

                    
                    // Queremos coincidencia exacta (case-insensitive) en LOC
                    var buscado = loc.trim().toLowerCase();
                    var html = "";
                    var encontrados = 0;

                    // Recorremos los elementos LOC y comparamos su texto normalizado
                    $(data).find('LOC').each(function(){
                        var textoLoc = $(this).text().trim().toLowerCase();
                        if(textoLoc === buscado){
                            encontrados++;
                            var nombreDept = $(this).parent().find("DNOMBRE").first().text();
                            var numDept = $(this).parent().attr("DEPT_NO");
                            var objecto = $(this).text();

                            html += "<tr>";
                            html += "<td>"+ numDept + "</td>";
                            html += "<td>"+ nombreDept + "</td>";
                            html += "<td>"+ objecto + "</td>";
                            html += "</tr>";
                        }
                    });

                    if(encontrados === 0){
                        alert("No existe esa localidad");
                        // limpiar la tabla por si había datos previos
                        $("#tabladepartamentos tbody").empty();
                        return;
                    }

                    // Mostrar resultados
                    $("#tabladepartamentos tbody").html(html);

                })

            })
                
        });
    </script>
</body>
</html>